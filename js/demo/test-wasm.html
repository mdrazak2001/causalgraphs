<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CausalGraphs WASM Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .success {
            color: #155724;
            background: #d4edda;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ CausalGraphs WASM Test</h1>
        <p>Testing the compiled WASM functions from Rust.</p>

        <button onclick="runTest()">Run Basic Test</button>
        <button onclick="runAdvancedTest()">Run Advanced Test</button>
        
        <div id="output" class="output">Click a button to run tests...</div>
    </div>

    <script type="module">
        import init, { RustDAG } from '../pkg-web/causalgraphs.js';

        window.init = init;
        window.RustDAG = RustDAG;

        async function runTest() {
            const output = document.getElementById('output');
            output.innerHTML = '<span class="loading">Initializing WASM...</span>';

            try {
                // Initialize the WASM module
                await init();
                output.innerHTML = '<span class="success">‚úÖ WASM initialized successfully!</span>\n\n';

                // Create a new DAG
                const dag = new RustDAG();
                output.innerHTML += '<span class="success">‚úÖ DAG created successfully!</span>\n\n';

                // Add some nodes
                dag.addNode('A');
                dag.addNode('B');
                dag.addNode('C');
                output.innerHTML += 'Added nodes: A, B, C\n';

                // Add edges
                dag.addEdge('A', 'B');
                dag.addEdge('B', 'C');
                output.innerHTML += 'Added edges: A‚ÜíB, B‚ÜíC\n\n';

                // Get graph information
                const nodes = dag.nodes();
                const edges = dag.edges;
                const nodeCount = dag.nodeCount;
                const edgeCount = dag.edgeCount;

                output.innerHTML += `Nodes: ${nodes.join(', ')}\n`;
                output.innerHTML += `Edges: ${JSON.stringify(edges)}\n`;
                output.innerHTML += `Node count: ${nodeCount}\n`;
                output.innerHTML += `Edge count: ${edgeCount}\n\n`;

                // Test graph traversal
                const parentsOfC = dag.getParents('C');
                const childrenOfA = dag.getChildren('A');
                const ancestorsOfC = dag.getAncestorsOf(['C']);

                output.innerHTML += `Parents of C: ${parentsOfC.join(', ')}\n`;
                output.innerHTML += `Children of A: ${childrenOfA.join(', ')}\n`;
                output.innerHTML += `Ancestors of C: ${ancestorsOfC.join(', ')}\n\n`;

                output.innerHTML += '<span class="success">üéâ All tests passed!</span>';

            } catch (error) {
                output.innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
                console.error('Error:', error);
            }
        }

        async function runAdvancedTest() {
            const output = document.getElementById('output');
            output.innerHTML = '<span class="loading">Running advanced test...</span>';

            try {
                await init();
                const dag = new RustDAG();

                // Add many nodes
                const nodeNames = ['X', 'Y', 'Z', 'W', 'V'];
                dag.addNodesFrom(nodeNames);

                // Create a more complex graph
                dag.addEdge('X', 'Y');
                dag.addEdge('Y', 'Z');
                dag.addEdge('X', 'W');
                dag.addEdge('W', 'Z');
                dag.addEdge('V', 'X');

                output.innerHTML = 'Created complex graph:\n';
                output.innerHTML += 'V ‚Üí X ‚Üí Y ‚Üí Z\n';
                output.innerHTML += '    ‚Üì   ‚Üë\n';
                output.innerHTML += '    W ‚Üí Z\n\n';

                // Test complex traversal
                const ancestorsOfZ = dag.getAncestorsOf(['Z']);
                const parentsOfZ = dag.getParents('Z');
                const childrenOfX = dag.getChildren('X');

                output.innerHTML += `Ancestors of Z: ${ancestorsOfZ.join(', ')}\n`;
                output.innerHTML += `Parents of Z: ${parentsOfZ.join(', ')}\n`;
                output.innerHTML += `Children of X: ${childrenOfX.join(', ')}\n\n`;

                output.innerHTML += '<span class="success">‚úÖ Advanced test completed!</span>';

            } catch (error) {
                output.innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
                console.error('Error:', error);
            }
        }

        // Make functions globally available
        window.runTest = runTest;
        window.runAdvancedTest = runAdvancedTest;
    </script>
</body>
</html> 